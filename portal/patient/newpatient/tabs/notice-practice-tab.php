    <style>
        a#signModalOpen {
            text-decoration: none;
            color: black;
            cursor: pointer;
        }
    </style>
    <form class="container-xl p-0" id="template" name="template" role="form" action="./../lib/doc_lib.php" method="POST">
        <div id="templatediv" class="card-body border overflow-auto">
            <div id="templatecontent" class="template-body">
                <h2>&nbsp;<br><br><br><br>
                    <span style="font-size:17pt;font-variant:normal;white-space:pre-wrap;">
                        <span style="font-family:Arial;">
                            <span style="color:#000000;">
                                <span style="font-weight:400;">
                                    <span style="font-style:normal;">
                                        <span style="text-decoration:none;">ABS Policies/ Agreements</span>
                                    </span>
                                </span>
                            </span>
                        </span>
                    </span>
                    <span style="font-size:11pt;font-variant:normal;white-space:pre-wrap;">
                        <span style="font-family:Arial;">
                            <span style="color:#000000;">
                                <span style="font-weight:400;">
                                    <span style="font-style:normal;">
                                        <span style="text-decoration:none;"> </span>
                                    </span>
                                </span>
                            </span>
                        </span>
                    </span>Notice of Practice Policies
                </h2><br><br>
                <p><strong>APPOINTMENTS AND CANCELLATIONS</strong>
                    - If you cannot attend your individual, family or group session,
                    please remember to cancel or reschedule 12 hours in advance.
                    You will be responsible for a $65.00 fee if the cancellation is
                    less than 12 hours. This is necessary because a time commitment
                    is made to you and is held exclusively for you. If you are late
                    for a session, you may lose some of that session time. The standard
                    meeting time for individual psychotherapy is 45/60 minutes. It is
                    up to you, however, to determine the length of time of your sessions.
                    Requests to change the 45/60-minute session need to be discussed with
                    the therapist in order for time to be scheduled in advance.
                </p><br><br>
                <p><strong>TELEPHONE ACCESSIBILITY</strong>
                    - If you need to contact your ABS therapist, please leave a message
                    on the voice mail. The therapist may not be immediately available;
                    however, they will attempt to return your call within 24 hours.
                    Please note that Face- to-face sessions are highly preferable to
                    phone sessions. However, in the event that you are out of town,
                    sick or need additional support, phone sessions are available.
                    If a true emergency situation arises, please call 911 or any local
                    emergency room.
                </p><br><br>
                <p><strong>SOCIAL MEDIA AND TELECOMMUNICATION</strong>
                    - Due to the importance of your confidentiality and the importance of
                    minimizing dual relationships, the therapist will not accept a friend or
                    contact requests from current or former clients on any social networking
                    site (Facebook, LinkedIn, etc). ABS believes that adding clients as friends
                    or contacts on these sites can compromise your confidentiality and our
                    respective privacy. It may also blur the boundaries of our therapeutic
                    relationship. If you have questions about this, please bring them up in
                    therapy with your therapist.
                </p><br><br>
                <p><strong>ELECTRONIC COMMUNICATION</strong>
                    - We cannot ensure the confidentiality of any form of communication through
                    electronic media, including text messages. If you prefer to communicate via
                    email or text messaging for issues regarding scheduling or cancellations,
                    we will do so. While we may try to return messages in a timely manner, we
                    cannot guarantee immediate response and request that you do not use these
                    methods of communication to discuss therapeutic content and/or request
                    assistance for emergencies. Services by electronic means, including but not
                    limited to telephone communication, the Internet, facsimile machines, and
                    e-mail is considered telemedicine by some states including the State of
                    California. Under the California Telemedicine Act of 1996, telemedicine is
                    broadly defined as the use of information technology to deliver medical
                    services and information from one location to another. If you and your
                    therapist chose to use information technology for some or all of your
                    treatment, you need to understand that: (1) You retain the option to
                    withhold or withdraw consent at any time without affecting the right to
                    future care or treatment or risking the loss or withdrawal of any program
                    benefits to which you would otherwise be entitled. (2) All existing
                    confidentiality protections are equally applicable. (3) Your access to all
                    medical information transmitted during a telemedicine consultation is
                    guaranteed, and copies of this information are available for a reasonable
                    fee. (4) Dissemination of any of your identifiable images or information
                    from the telemedicine interaction to researchers or other entities shall
                    not occur without your consent.(5) There are potential risks, consequences,
                    and benefits of telemedicine. Potential benefits include, but are not
                    limited to improved communication capabilities, providing convenient access
                    to up-to-date information, consultations, support, reduced costs, improved
                    quality, change in the conditions of practice, improved access to therapy,
                    better continuity of care, and reduction of lost work time and travel costs.
                    Effective therapy is often facilitated when the therapist gathers within a
                    session or a series of sessions, a multitude of observations, information,
                    and experiences about the client. Therapists may make clinical assessments,
                    diagnosis, and interventions based not only on direct verbal or auditory
                    communications, written reports, and third person consultations, but also
                    from direct visual and olfactory observations, information, and experiences.
                    When using information technology in therapy services, potential risks
                    include, but are not limited to the therapist’s inability to make visual and
                    olfactory observations of clinically or therapeutically potentially relevant
                    issues such as: your physical condition including deformities, apparent
                    height and weight, body type, attractiveness relative to social and cultural
                    norms or standards, gait and motor coordination, posture, work speed, any
                    noteworthy mannerism or gestures, physical or medical conditions including
                    bruises or injuries, basic grooming and hygiene including appropriateness of
                    dress, eye contact (including any changes in the previously listed issues),
                    sex, chronological and apparent age, ethnicity, facial and body language,
                    and congruence of language and facial or bodily expression. Potential
                    consequences thus include the therapist not being aware of what he or she
                    would consider important information, that you may not recognize as
                    significant to present verbally to the therapist.
                </p><br><br>
                <p><strong>MINORS</strong>
                    - If you are a minor, your parents may be legally entitled to some information
                    about your therapy. We will discuss with you and your parents’ what information
                    is appropriate for them to receive and which issues are more appropriately kept
                    confidential.
                </p><br><br>
                <p><strong>TERMINATION</strong>
                    - Ending relationships can be difficult. Therefore, it is important to have a
                    termination process in order to achieve some closure. The appropriate length of
                    the termination depends on the length and intensity of the treatment. ABS may
                    terminate treatment after appropriate discussion with you and a termination
                    process if ABS determines that the psychotherapy is not being effectively used
                    or if you are in default on payment. ABS will not terminate the therapeutic
                    relationship without first discussing and exploring the reasons and purpose of
                    terminating. If therapy is terminated for any reason or you request another
                    therapist, we will provide you with a list of qualified psychotherapists to
                    treat you. You may also choose someone on your own or from another referral
                    source.Should you fail to schedule an appointment for three consecutive weeks,
                    unless other arrangements have been made in advance, for legal and ethical
                    reasons, ABS must consider the professional relationship discontinued.
                </p><br><br>
                <p><strong>Notice of Practice Policies</strong>
                    - I have read, understood, and agree to the items contained in this document.
                </p><br><br>
                <p><strong>CONSENT TO USE THE TELEHEALTH SERVICE-</strong>
                    I agree to voluntarily seek behavioral health /mental health/ counseling and
                    psychotherapy telemedicine services at ABS.</p><br><br>
                <p>Telehealth is the
                    technology service we will use to conduct telehealth video conferencing
                    appointments. You will be given a link or password required to log in. By signing
                    this document, I acknowledge:</p><br><br>
                <p>1. Telehealth is NOT an Emergency
                    Service and in the event of an emergency, I will use a phone to call 911.
                </p><br><br>
                <p>
                    2. Though ABS and I may be in direct, virtual contact through the Telehealth
                    Service, the Telehealth Service does not provide any medical or healthcare services
                    or advice including, but not limited to, emergency or urgent medical services.
                </p><br><br>
                <p>
                    3. The Telehealth Service facilitates videoconferencing and is not responsible for
                    the delivery of any physical healthcare, medical advice or care.
                </p><br><br>
                <p>
                    4. I do not assume that ABS has access to any or all of the technical information in
                    the Telehealth Service – or that such information is current, accurate or up to date.
                    I will not rely on ABS to have any of this information in the Telehealth Service.
                </p><br><br>
                <p>
                    5. To maintain confidentiality, I will not share my telehealth appointment link with
                    anyone unauthorized to attend the appointment.
                </p><br><br>
                <p><span class="marker"><strong>By signing this form, I certify</strong>:</span></p><br><br>
                <p>• That I have read or had this form read and/or had this form explained to me.</p><br><br>
                <p>• That I fully understand its contents including the risks and benefits of the procedure(s).</p><br><br>
                <p><strong>CONSENT TO USE THE TELEHEALTH SERVICE</strong>
                    - I have read, understood, and agree to the items contained in this document.
                </p><br><br>
                <p><strong>Drug Testing Policy:</strong>
                    I am aware that if I am under court order to attend Applied Behavioral Sciences as part of
                    my treatment, I may be asked to void supervised urine specimens periodically throughout my
                    treatment. I am aware that if I am under court order and refuse to submit to this may result
                    in being terminated from the program.
                </p><br><br>
                <p><strong>Progress Reporting:</strong>
                    I am aware that I must keep track of all my court appearances and legal hearings and must
                    request a progress report from the program no less than one week in advance to prepare for
                    my hearing. The only accepted request for documentation should be made at
                    ABSBehavioralhealth.com Documentation Request TAB and submit your request for a progress
                    report.
                </p><br><br>
                <p><span class="marker"><strong>I am aware</strong></span>
                    that I will be required to pay a fee if I do not request documentation prior to one week of
                    your hearing and if I need a progress report in less than one-week time. I must make an
                    Expedited Documentation Request at ABSBehavioralhealth.com.
                </p><br><br>
                <p><span class="marker"><strong>I am aware</strong></span>
                    that I must produce a credit card or backup means of payment and will be asked to produce
                    the means of payment before your intake session. I authorize Applied Behavioral Sciences
                    to charge my credit card for the following
                </p><br><br>
                <p>· Charges for all counseling/consultation services</p><br><br>
                <p>· Copay or coinsurance rate for all attended appointments</p><br><br>
                <p>· Any portion of billable services not covered by my insurance policy</p><br><br>
                <p>· Full charge for any appointment missed or canceled without proper notice</p><br><br>
                <p>· Expedited requests for written progress reports</p><br><br>
                <p>
                    - Request for detailed progress reports by me or my representative such as social
                    worker, atterny or referal sorce such as court.
                </p><br><br>
                <p><strong>Signature on File</strong>
                    - I understand and agree that I am responsible for the payment of any and all charges
                    incurred as a result of this or any subsequent visit(s). I also understand and agree
                    to accept responsibility for payment of any and all claims should my insurance carrier
                    deny all or part of a claim. I understand and agree that all insurance deductibles and
                    any incurred expenses not covered by the insured’s health carrier must be paid for at
                    the time of services. I hereby authorize payment directly to Applied behavioral
                    Sciences, for any services rendered to me by ABS or any authorized agents. I authorize
                    the release of all medical information to the insured’s health insurance carrier that
                    is: 1) acquired in the course of my examination or treatment and 2) which may have a
                    bearing on the benefits payable under this or any other plan that provides benefits or
                    services. I authorize ABS or any authorized agents to assist in obtaining payment from
                    my health insurance companies. I authorize a copy of this “Signature on File” form to
                    be used in place of the original and that this copy may be used on all my insurance
                    submissions.
                </p><br><br>
                <p>&nbsp;</p><br><br>
                <p><?php echo $patient['name']; ?></p><br><br>
                <script>
                    page.presentPatientSignature = true;
                    page.presentWitnessSignature = true;
                </script>
                <span>
                    <?php if (isset($onsite_signature['sign']) && !empty($onsite_signature['sign'])) { ?>
                        <label for="patientSignature"><?php echo xlt("Patient Signature"); ?></label>
                        <img class="signature" id="patientSignature" style="cursor:pointer;color:red;height:65px !important;width:auto;" data-type="<?php echo ($onsite_signature['type']); ?>" data-action="fetch_signature" alt="(Click in signature)" data-pid="<?php echo (isset($pid)) ? (int)$pid : ''; ?>" data-user="<?php echo (isset($onsite_signature['user'])) ? $onsite_signature['user'] : ''; ?>" src="<?php echo (isset($onsite_signature['sign'])) ? $onsite_signature['sign'] : ''; ?>">
                        <!-- <br><br>
                        <label for="witnessSignature"><?php echo xlt("Witness Signature"); ?></label>
                        <img class="signature" id="witnessSignature" style="cursor:pointer;color:red;height:65px !important;width:auto;" data-type="<?php echo ($onsite_signature['type']); ?>" data-action="fetch_signature" alt="(Click in signature)" data-pid="<?php echo (isset($pid)) ? (int)$pid : ''; ?>" data-user="<?php echo (isset($onsite_signature['user'])) ? $onsite_signature['user'] : ''; ?>" src="<?php echo (isset($onsite_signature['sign'])) ? $onsite_signature['sign'] : ''; ?>"> -->

                    <?php } else { ?>
                        <label for="patientSignature"><?php echo xlt("Patient Signature"); ?></label>
                        <a class="dropdown-item" id="signModalOpen" data-toggle="modal">
                            <i class="fa fa-file-signature"></i>
                            create Signature
                        </a>
                        <!-- <br><br>
                        <label for="witnessSignature"><?php echo xlt("Witness Signature"); ?></label>
                        <a class="dropdown-item" id="signModalOpen" data-toggle="modal">
                            <i class="fa fa-file-signature"></i>
                            create Signature
                        </a> -->


                    <?php } ?>

                    <br><br>
                    Date&nbsp; <?php echo date('Y-m-d'); ?>

                </span>



            </div>

        </div>

        <input type="hidden" name="csrf_token_form" id="csrf_token_form" value="e81f4710111a71ca4f518e1d3820871f89d3c8fe">
        <input type="hidden" name="content" id="content" value="">
        <input type="hidden" name="cpid" id="cpid" value="">
        <input type="hidden" name="docid" id="docid" value="Notice Of Practice Policies">
        <input type="hidden" name="template_id" id="template_id" value="">
        <input type="hidden" name="handler" id="handler" value="download">
        <input type="hidden" name="status" id="status" value="Open">
        <script>

        </script>
        <script>
            /**
             * @package   OpenEMR
             * @link      http://www.open-emr.org
             * @author    Jerry Padgett <sjpadgett@gmail.com>
             * @copyright Copyright (c) 2016-2021 Jerry Padgett <sjpadgett@gmail.com>
             * @license   https://github.com/openemr/openemr/blob/master/LICENSE GNU General Public License 3
             */

            const signhere = "data:image/svg+xml,%3C%3Fxml version='1.0' standalone='no'%3F%3E%3C!DOCTYPE svg PUBLIC '-//W3C//DTD SVG 20010904//EN' 'http://www.w3.org/TR/2001/REC-SVG-20010904/DTD/svg10.dtd'%3E%3Csvg version='1.0' xmlns='http://www.w3.org/2000/svg' width='852.000000pt' height='265.000000pt' viewBox='0 0 852.000000 265.000000' preserveAspectRatio='xMidYMid meet'%3E%3Cg transform='translate(0.000000,265.000000) scale(0.100000,-0.100000)'%0Afill='%23000000' stroke='none'%3E%3Cpath d='M390 1534 c-19 -14 -67 -57 -107 -96 l-71 -71 -31 34 c-16 19 -38 49%0A-48 67 -18 32 -53 44 -53 18 0 -17 47 -111 72 -144 17 -23 17 -25 -21 -75 -46%0A-62 -85 -143 -77 -163 3 -8 14 -14 25 -14 15 0 27 15 45 53 23 52 71 117 85%0A117 4 0 15 -15 25 -32 11 -18 34 -50 52 -70 18 -20 40 -51 49 -67 9 -19 23%0A-31 35 -31 38 0 18 71 -34 119 -33 31 -89 117 -84 130 1 6 49 57 106 115 56%0A57 102 111 102 120 0 23 -29 18 -70 -10z'/%3E%3C/g%3E%3C/svg%3E";

            let adminName = '';
            let $lastEl = '';
            let isAdmin = false;
            let type = '';
            if (typeof isPortal === 'undefined') {
                var isPortal = 0;
            }

            if (typeof ptName === 'undefined') {
                var ptName = '';
            }
            if (typeof webRoot === 'undefined' && typeof top.webroot_url !== 'undefined') {
                var webRoot = top.webroot_url;
            }
            if (typeof isModule === 'undefined') {
                var isModule = false;
            }

            if (typeof cpid === 'undefined') {
                var cpid;
            }

            if (typeof cuser === 'undefined') {
                var cuser;
            }

            function signerAlertMsg(message, timer = 5000, type = 'danger', size = '') {
                console.log("Alert Message:", message);
                $('#signerAlertBox').remove();
                size = (size == 'lg') ? 'left:25%;width:50%;' : 'left:35%;width:30%;';
                let style = "position:fixed;top:25%;" + size + " bottom:0;z-index:1020;z-index:5000";
                $("body").prepend("<div class='container text-center' id='signerAlertBox' style='" + style + "'></div>");
                let mHtml = '<div id="alertMessage" class="alert alert-' + type + ' alert-dismissable">' +
                    '<button type="button" class="close btn btn-link btn-cancel" data-dismiss="alert" aria-hidden="true">&times;</button>' +
                    '<h5 class="alert-heading text-center">Alert!</h5><hr>' +
                    '<p>' + message + '</p>' +
                    '</div>';
                $('#signerAlertBox').append(mHtml);
                $('#alertMessage').on('closed.bs.alert', function() {
                    clearTimeout(AlertMsg);
                    $('#signerAlertBox').remove();
                });
                let AlertMsg = setTimeout(function() {
                    $('#alertMessage').fadeOut(800, function() {
                        $('#signerAlertBox').remove();
                    });
                }, timer);
            }

            function getSignature(othis, isInit = false, returnSignature = false) {
                return new Promise(resolve => {
                    let signer, signerType = "";
                    let isSigned = isDataURL($(othis).attr('src'));
                    let libUrl = "./";

                    if ($(othis).attr('src') != signhere && !isInit) {
                        $(othis).attr('src', signhere);
                        return;
                    }
                    if (typeof webRoot !== 'undefined' && typeof webRoot !== null) {
                        libUrl = webRoot + '/portal/';
                    } else {
                        libUrl = top.webroot_url ? (top.webroot_url + '/portal/') : "./";
                    }

                    if (typeof cpid === 'undefined' && typeof cuser === 'undefined') {
                        cpid = $(othis).data('pid');
                        cuser = $(othis).data('user');
                    }
                    let otype = $(othis).attr('data-type');
                    type = otype;
                    if (typeof otype === 'undefined' || typeof otype === null) {
                        otype = $(othis).data('type');
                    }
                    if (otype == 'admin-signature') {
                        signer = adminName ? adminName : cuser;
                        signerType = "admin-signature";
                        $("#isAdmin").prop('checked', true);
                        isAdmin = true;
                    } else if (otype == 'witness-signature') {
                        signer = 'Witness';
                        signerType = "witness-signature";
                        $("#isAdmin").prop('checked', false);
                        isAdmin = false;
                        return false;
                    } else {
                        signer = ptName;
                        signerType = "patient-signature";
                        $("#isAdmin").prop('checked', false);
                        isAdmin = false;
                    }

                    let params = {
                        pid: cpid,
                        user: cuser,
                        is_portal: isPortal,
                        type: signerType
                    };


                    let url = libUrl + "sign/lib/show-signature.php";
                    fetch(url, {
                        credentials: 'include',
                        method: 'POST',
                        body: JSON.stringify(params),
                        headers: {
                            'Accept': 'application/json, text/plain, */*',
                            'Content-Type': 'application/json'
                        }
                    }).then(signature => signature.json()).then(signature => {
                        if (returnSignature === true) {
                            return signature;

                        }
                        placeSignature(signature, othis).then(function(r) {
                            resolve(r)
                            console.log("Signature:", signature);
                        })

                    }).catch(error => signerAlertMsg(error));
                })
            }

            function placeSignature(responseData, el) {
                return new Promise(resolve => {
                    if (responseData.message === "error") {
                        $(el).attr('src', "");
                        $(el).attr('alt', "No Signature on File");
                        signerAlertMsg('Error Patient and or User Id missing');
                        return;
                    } else if (responseData.message === "insert error") {
                        $(el).attr('src', "");
                        $(el).attr('alt', "No Signature on File");
                        signerAlertMsg('Error adding signature');
                        return;
                    } else if (responseData.message === "waiting" && $(el).attr('data-type') === 'patient-signature') {
                        $(el).attr('src', "");
                        $(el).attr('alt', "No Signature on File");
                        $("#isAdmin").attr('checked', false);
                        return;
                    } else if (responseData.message === "waiting" && $(el).attr('data-type') === 'admin-signature') {
                        $(el).attr('src', "");
                        $(el).attr('alt', "No Signature on File");
                        $("#isAdmin").attr('checked', true);
                        return;
                    } else if (responseData.message === "waiting") {
                        $(el).attr('src', "");
                        $(el).attr('alt', "No Signature on File");
                        return;
                    }
                    let i = new Image();
                    i.onload = function() {
                        $(el).attr('src', i.src)
                        resolve('done'); // display image
                    };
                    i.src = isDataURL(responseData) ? responseData : 'data:image/png;base64,' + responseData; // load image
                })
            }

            function archiveSignature(signImage = '', edata = '') {
                let libUrl, signer, signerType = "";
                let pid = 0;
                let data = {};

                if (typeof webRoot !== 'undefined' && typeof webRoot !== null) {
                    libUrl = webRoot + '/portal/';
                } else {
                    libUrl = "./";
                }

                if (edata) {
                    data = {
                        pid: edata.data.cpid,
                        user: edata.data.cuser,
                        is_portal: isPortal,
                        signer: edata.data.signer,
                        type: edata.data.type,
                        output: signImage
                    };
                } else {
                    if ($("#isAdmin").is(':checked') === false) {
                        pid = cpid;
                        signer = ptName ? ptName : cuser;
                        signerType = "patient-signature";
                    } else {
                        pid = 0;
                        signer = adminName ? adminName : cuser;
                        signerType = "admin-signature";
                    }
                    data = {
                        pid: pid,
                        user: cuser,
                        is_portal: isPortal,
                        signer: signer,
                        type: signerType,
                        output: signImage
                    };
                }
                let url = libUrl + "sign/lib/save-signature.php";
                fetch(url, {
                    credentials: 'include',
                    method: 'POST',
                    body: JSON.stringify(data),
                    headers: {
                        'Content-Type': 'application/json',
                        'Connection': 'close'
                    }
                }).then(response => response.json()).then(function(response) {
                    $("#openSignModal").modal("hide");
                }).catch(error => signerAlertMsg(error));

                return true;
            }

            function isDataURL(dataUrl) {
                return !!dataUrl.match(isDataURL.regex);
            }

            isDataURL.regex = /^\s*data:([a-z]+\/[a-z]+(;[a-z\-]+\=[a-z\-]+)?)?(;base64)?,[a-z0-9\!\$\&\'\,\(\)\*\+\,\;\=\-\.\_\~\:\@\/\?\%\s]*\s*$/i;

            // call if need to bind pen clicks after a dynamic template load. ie templates.
            var bindFetch = '';

            // fetch modal template and append to body.
            //
            $(function() {
                let url = top.webroot_url ? top.webroot_url : webRoot;
                url += "/portal/sign/assets/signer_modal.php?isPortal=" + encodeURIComponent(isPortal);
                fetch(url, {
                    credentials: 'include'
                }).then(jsonTemplate => jsonTemplate.json()).then(jsonTemplate => {
                    $("body").append(jsonTemplate);
                }).then(function() {
                    initSignerApi();
                }).catch((error) => alert("Modal Template Fetch:" + error));
            });

            function initSignerApi() {
                // ya think there'd be more!
                function callModal(e) {
                    cpid = e.data.cpid;
                    cuser = e.data.cuser;
                    let type = e.data.type;
                    let signerName = e.data.signerName || '';

                    $('#openSignModal #name').val(signerName);
                    $('#openSignModal #labelName').html("&nbsp;" + msgSignator + ":&nbsp;<b>" + signerName + "</b>");
                    $('#openSignModal #pid').val(cpid);
                    $('#openSignModal #user').val(cuser);
                    $('#openSignModal #signatureModal').data('type', type);
                    if (type === 'admin-signature' && isPortal) {
                        signerAlertMsg(xl('Signer Pad not available for this signature type!', 2000));
                        return false;
                    }
                    if (type === 'admin-signature') {
                        adminName = signerName;
                        $("#isAdmin").prop('checked', true);
                        isAdmin = true;
                    } else {
                        ptName = signerName;
                        $("#isAdmin").prop('checked', false);
                        isAdmin = false;
                    }
                    $("#openSignModal").modal('show');

                }

                function doConfirm(result) {
                    placeSignature(result.data.signature, $lastEl);
                }

                // global binding for signer form/template tag clicks.
                // gets called after a new/edited template gets loaded.
                // mostly used with Patient Documents list however,
                // existing portal workflow is legacy and will deprecate here soon.
                bindFetch = function() {
                    $("img[data-action=fetch_signature]").on("click", function(e) {
                        e.stopPropagation();
                        e.preventDefault();
                        $lastEl = $(this);
                        let pid = $lastEl.data('pid');
                        let user = $lastEl.data('user');
                        let type = $lastEl.data('type');
                        $('#openSignModal #signatureModal').data('type', type);
                        let signerName = '';
                        let url = webRoot + "/portal/sign/lib/show-signature.php";
                        if (!cpid) {
                            cpid = pid;
                        }
                        if (!cuser) {
                            cuser = user;
                        }
                        if (type === "admin-signature" && isPortal) {
                            // don't allow patient to change user signature.
                            return false;
                        } else if (isPortal && type !== "witness-signature") {
                            getSignature(this);
                            return false;
                        }
                        $lastEl.attr('src', signhere);

                        fetch(url, {
                            credentials: 'include',
                            method: 'POST',
                            body: JSON.stringify({
                                pid: pid,
                                user: user,
                                type: type,
                                is_portal: isPortal,
                                mode: 'fetch_info'
                            }),
                            headers: {
                                'Accept': 'application/json, text/plain, */*',
                                'Content-Type': 'application/json'
                            }
                        }).then(response => response.json()).then(function(response) {
                            let signerName = '';
                            if (type === "admin-signature") {
                                signerName = response.userName;
                                adminName = signerName;
                            } else {
                                signerName = response.ptName;
                                ptName = signerName;
                            } // response.signature is available if needed in future.
                            let e = [];
                            e.data = {
                                cpid: pid,
                                cuser: user,
                                type: type,
                                signerName: signerName
                            };
                            callModal(e);
                        }).catch(error => signerAlertMsg(error));
                    });

                    $(function() {
                        // default all signatures to icon regardless of new or edit..
                        $(".signature").each(function(index, value) {
                            if (!$(this).attr('src'))
                                $(this).attr('src', signhere);
                        });
                    });
                };

                // initial binds for form pen clicks
                bindFetch();

                //-------------------- Continue loading seq with init of modal buttons and various bindings --------------------//
                $(function(global) {
                    var wrapper = document.getElementById("openSignModal");
                    var canvasOptions = {
                        minWidth: 1.00,
                        maxWidth: 2.75,
                        penColor: 'rgb(0, 0, 0)',
                        minDistance: 4,
                        /*throttle: 0,*/
                        velocityFilterWeight: .5,
                    };
                    var openPatientButton = document.querySelector("[data-type=patient-signature]");
                    var openAdminButton = document.querySelector("[data-type=admin-signature]");
                    var placeSignatureButton = wrapper.querySelector("[data-action=place]");
                    var showSignature = wrapper.querySelector("[data-action=show]");
                    var saveSignature = wrapper.querySelector("[data-action=save_signature]");
                    var clearButton = wrapper.querySelector("[data-action=clear]");
                    var canvas = wrapper.querySelector("canvas");
                    let signaturePad;

                    // this offsets signature image to center on element somewhat
                    // on any form (css) box height:70px length:auto center at 20px.
                    $(function(e) {
                        let els = this.querySelectorAll("img[data-action=fetch_signature]");
                        let i; // caution using let in for
                        for (i = 0; i < els.length; i++) {
                            els[i].style.top = (els[i].offsetTop - 20) + 'px';
                            els[i].setAttribute("data-offset", true);
                        }
                    });

                    $("#openSignModal .close").on("click", function(e) {
                        signaturePad.clear();
                    });

                    if (typeof placeSignatureButton === 'undefined' || !placeSignatureButton) {
                        placeSignatureButton = wrapper.querySelector("[data-action=place]");
                    }
                    $("#openSignModal").on('show.bs.modal', function(e) {
                        let type = $('#openSignModal #signatureModal').data('type');
                        if (type === 'admin-signature' && isPortal) {
                            signerAlertMsg('Signer Pad not available for this signature type!', 2000);
                            return false;
                        }
                        if (type === 'witness-signature') {
                            placeSignatureButton.classList.add('d-none');
                        } else {
                            placeSignatureButton.classList.remove('d-none');
                        }
                    });
                    // for our dynamically added modal
                    $("#openSignModal").on('shown.bs.modal', function(e) {
                        let type = $('#openSignModal #signatureModal').data('type');
                        if (type) {
                            if (type === "admin-signature") {
                                $("#isAdmin").prop('checked', true);
                                placeSignatureButton.setAttribute("data-type", type);
                                isAdmin = true;
                            } else {
                                $("#isAdmin").prop('checked', false);
                                placeSignatureButton.setAttribute("data-type", type);
                                isAdmin = false;
                            }
                            $('#signatureModal').data('type', type);
                        }
                        let showElement = document.getElementById('signatureModal');
                        $('#signatureModal').attr('src', signhere);
                        $("#openSignModal").modal({
                            backdrop: false
                        });
                        $('html').css({
                            'overflow': 'hidden'
                        });
                        $(this).css({
                            'padding-right': '0px'
                        });
                        $('body').bind('selectstart', function() {
                            return false;
                        });
                        $(this).modal('handleUpdate');
                    }).on('shown.bs.modal', function(e) { // yes two shown events
                        signaturePad = new SignaturePad(canvas, canvasOptions);
                        resizeCanvas();
                    }).on('hide.bs.modal', function() {
                        if ((typeof $lastEl !== 'undefined' || !$lastEl) && typeof event === "undefined") {
                            if (!signaturePad.isEmpty()) {
                                let dataURL = signaturePad.toDataURL();
                                placeSignature(dataURL, $lastEl);
                            }
                        }
                    }).on('hidden.bs.modal', function() {
                        $('html').css({
                            'overflow': 'inherit'
                        });
                        $('body').unbind('selectstart');
                    });

                    clearButton.addEventListener("click", function(event) {
                        signaturePad.clear();
                    });

                    saveSignature.addEventListener("click", function(event) {
                        if (signaturePad.isEmpty()) {
                            signerAlertMsg(msgNeedSign, 3000);
                            return false;
                        }
                        let signerName, type = '';
                        type = $('#signatureModal').data('type');
                        if ($("#isAdmin").is(':checked') === true || type === 'admin-signature') {
                            isAdmin = true;
                        }
                        if (type === 'witness-signature') {
                            let dataURL = signaturePad.toDataURL();
                            let e = [];
                            e.data = {
                                cpid: cpid,
                                cuser: cuser,
                                type: type,
                                signer: 'Witness Signature'
                            };
                            archiveSignature(encodeURIComponent(dataURL), e);
                            return false;
                        }
                        webRoot = webRoot ? webRoot : top.webroot_url;
                        let url = webRoot + "/portal/sign/lib/show-signature.php";
                        fetch(url, {
                            credentials: 'include',
                            method: 'POST',
                            body: JSON.stringify({
                                pid: cpid,
                                user: cuser,
                                type: type,
                                is_portal: isPortal,
                                mode: 'fetch_info'
                            }),
                            headers: {
                                'Accept': 'application/json, text/plain, */*',
                                'Content-Type': 'application/json'
                            }
                        }).then(response => response.json()).then(function(response) {
                            signerName = ptName = response.ptName;
                            if (isAdmin) {
                                signerName = adminName = response.userName;
                            }
                            let dataURL = signaturePad.toDataURL();
                            let e = [];
                            e.data = {
                                cpid: cpid,
                                cuser: cuser,
                                type: type,
                                signer: signerName
                            };
                            archiveSignature(encodeURIComponent(dataURL), e);
                        });
                    });

                    placeSignatureButton.addEventListener("click", function(event) {
                        let thisElement = $(this);
                        getSignature(thisElement, true).then(r => {
                            let imgurl = thisElement.attr('src');
                            signaturePad.fromDataURL(imgurl);
                        });
                    });

                    if (showSignature !== null)
                        showSignature.addEventListener("click", function(event) { // for modal view
                            let showElement = document.getElementById('signatureModal');
                            getSignature(showElement);
                        });

                    function resizeCanvas() {
                        let ratio = Math.max(window.devicePixelRatio || 1, 1);
                        canvas.width = canvas.offsetWidth * ratio;
                        canvas.height = canvas.offsetHeight * ratio;
                        canvas.getContext("2d").scale(ratio, ratio);
                    }

                    // this is nifty JS download. leaving for future.
                    // plus someone may come across and find useful.
                    function download(dataURL, filename) {
                        let blob = dataURLToBlob(dataURL);
                        let url = window.URL.createObjectURL(blob);
                        let a = document.createElement("a");
                        a.style = "display: none";
                        a.href = url;
                        a.download = filename;
                        document.body.appendChild(a);
                        a.click();
                        window.URL.revokeObjectURL(url);
                    }

                    function dataURLToBlob(dataURL) {
                        // Code taken from https://github.com/ebidel/filer.js
                        let parts = dataURL.split(';base64,');
                        let contentType = parts[0].split(":")[1];
                        let raw = window.atob(parts[1]);
                        let rawLength = raw.length;
                        let uInt8Array = new Uint8Array(rawLength);

                        for (var i = 0; i < rawLength; ++i) {
                            uInt8Array[i] = raw.charCodeAt(i);
                        }

                        return new Blob([uInt8Array], {
                            type: contentType
                        });
                    }

                    // TODO create method to remove line on canvas save
                    function drawSignatureLine() {
                        let context = canvas.getContext('2d');
                        context.lineWidth = .4;
                        context.strokeStyle = '#333';
                        context.beginPath();
                        context.moveTo(0, 200);
                        context.lineTo(900, 200);
                        context.stroke();
                    }

                    // resize  event and initial resize
                    window.onresize = function() {
                        resizeCanvas();
                    };
                    resizeCanvas();
                }); // dom



            }
        </script>


    </form>